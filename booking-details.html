<!DOCTYPE html>
<html lang="he" dir="rtl">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>פרטי הזמנה - מרכז קהילתי עם שלום</title>
  <link rel="icon" href="https://cdn-icons-png.flaticon.com/512/2991/2991119.png" type="image/png">
  <style>
    :root {
      --primary: #1a73e8;
      --light: #f8f9fa;
      --dark: #333;
      --success: #e8f5e9;
    }
    * {box-sizing:border-box;margin:0;padding:0;font-family:'Segoe UI',Tahoma,Geneva,Verdana,sans-serif;}
    body{
      background:linear-gradient(rgba(0,0,0,.6),rgba(0,0,0,.6)),
                 url('https://images.unsplash.com/photo-1622278494980-874d6f8bf7ed?ixlib=rb-4.0.3&auto=format&fit=crop&w=1950&q=80')
                 center/cover no-repeat fixed;
      color:#fff;line-height:1.6;min-height:100vh;padding:20px;
    }
    .container{
      max-width:600px;margin:40px auto;background:rgba(255,255,255,.97);color:var(--dark);
      border-radius:15px;padding:30px;box-shadow:0 10px 40px rgba(0,0,0,.3);
      text-align:center;
    }
    h1{
      color:var(--primary);margin-bottom:20px;font-size:1.8rem;
    }
    .summary-box{
      background:#f0f8ff;padding:20px;border-radius:12px;margin-bottom:25px;
      border-left:5px solid var(--primary);text-align:right;
    }
    .summary-box p{
      margin:12px 0;font-size:1.1rem;
    }
    .summary-box strong{
      color:var(--primary);
    }
    .form-group{
      margin-bottom:18px;text-align:right;
    }
    label{
      display:block;margin-bottom:8px;font-weight:600;
    }
    input[type=text], input[type=email], input[type=tel]{
      width:100%;padding:12px;border:1px solid #ccc;border-radius:6px;font-size:1rem;
      text-align:right;
    }
    .submit-btn{
      background:var(--primary);color:#fff;border:none;padding:14px 24px;font-size:1.1rem;
      border-radius:8px;cursor:pointer;width:100%;margin-top:20px;transition:.2s;
    }
    .submit-btn:hover{background:#0d47a1;}
    .close-btn{
      position:absolute;top:15px;left:15px;background:#f44336;color:#fff;
      border:none;padding:8px 12px;border-radius:6px;cursor:pointer;font-size:0.9rem;
    }
    .close-btn:hover{background:#d32f2f;}
    .final-message{
      margin-top:25px;padding:15px;background:var(--success);border-radius:8px;
      font-weight:600;color:#1b5e20;display:none;
    }
  </style>
</head>
<body>

<div class="container">
  <button class="close-btn" onclick="window.close()">×</button>
  <h1>השלם את ההזמנה</h1>

  <div class="summary-box" id="summary"></div>

  <form id="personalDetailsForm">
    <div class="form-group">
      <label for="fullName">שם מלא *</label>
      <input type="text" id="fullName" required placeholder="הכנס שם מלא" />
    </div>
    <div class="form-group">
      <label for="phone">טלפון *</label>
      <input type="tel" id="phone" required pattern="05[0-9]-[0-9]{7}" placeholder="050-1234567" title="טלפון בפורמט: 05X-XXXXXXX" />
    </div>
    <div class="form-group">
      <label for="email">אימייל</label>
      <input type="email" id="email" placeholder="example@email.com" />
    </div>

    <button type="submit" class="submit-btn">אישור סופי והזמנה</button>
  </form>

  <div class="final-message" id="finalMessage"></div>
</div>

<script>
  // קריאה מה-hash
  const hash = window.location.hash.substring(1);
  if (!hash) {
    document.body.innerHTML = '<h2 style="text-align:center;color:red;">שגיאה: אין נתוני הזמנה</h2>';
  }

  let data;
  try {
    data = JSON.parse(atob(hash));
  } catch (e) {
    document.body.innerHTML = '<h2 style="text-align:center;color:red;">שגיאה בנתונים</h2>';
  }

  const { court, day, time, duration, total, lang = 'he' } = data;

  const finalMsg = lang === 'en'
    ? "Thank you! Your booking is confirmed. Confirmation sent via SMS."
    : "תודה! ההזמנה נקלטה במערכת. נשלח לך אישור ב-SMS.";

  document.getElementById('finalMessage').textContent = finalMsg;

  document.getElementById('summary').innerHTML = `
    <p><strong>מגרש:</strong> ${court}</p>
    <p><strong>יום:</strong> ${day}</p>
    <p><strong>שעה:</strong> ${time}</p>
    <p><strong>משך:</strong> ${duration === '1' ? (lang === 'en' ? '1 Hour' : 'שעה אחת') : (lang === 'en' ? '2 Hours' : 'שעתיים')}</p>
    <p><strong>סה"כ לתשלום:</strong> ${total}</p>
  `;

  document.getElementById('personalDetailsForm').addEventListener('submit', function(e) {
    e.preventDefault();

    const name = document.getElementById('fullName').value.trim();
    const phone = document.getElementById('phone').value.trim();
    const email = document.getElementById('email').value.trim();

    if (!name || !phone) {
      alert(lang === 'en' ? 'Please enter name and phone' : 'אנא מלא שם וטלפון');
      return;
    }

    // שמירה ב-localStorage
    const booking = { court, day, time, duration, total, name, phone, email, timestamp: new Date().toISOString() };
    let bookings = JSON.parse(localStorage.getItem('tennisBookings') || '[]');
    bookings.push(booking);
    localStorage.setItem('tennisBookings', JSON.stringify(bookings));

    // שליחה ל-WhatsApp (הפעל אם תרצה)
    /*
    const waMsg = encodeURIComponent(
      `הזמנה חדשה!\nמגרש: ${court}\nיום: ${day}\nשעה: ${time}\nמשך: ${duration} שעות\nשם: ${name}\nטלפון: ${phone}`
    );
    window.open(`https://wa.me/972501234567?text=${waMsg}`);
    */

    document.getElementById('personalDetailsForm').style.display = 'none';
    document.getElementById('finalMessage').style.display = 'block';
  });
</script>

</body>
</html>